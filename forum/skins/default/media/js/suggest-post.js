"use strict";StackPointer.suggestedEdits=function(){var f={},o=function(g){return $(g).closest(".suggested-edit").attr("id").substring(15)},a=function(g){return $.grep($(g).closest(".suggested-edit").attr("class").split(" "),function(i){return 0===i.indexOf("post-type-id-")})[0].substring(13)},c=function(j,l,m,g){var n=o(j),k=j.closest("form");var i="suggested-edit";if(j.attr("id")=="tag"){i="tag-suggested-edit"}k.data("working")||(k.data("working",!0).find("input[type=button]").disable(),StackPointer.helpers.addSpinner(j,{padding:"0 3x"}),$.ajax({url:"/{suggesttype}/{editId}/vote/{type}".format({editId:n,type:l,suggesttype:i}),data:{reasonId:m,customReason:g},dataType:"json",type:"POST",success:function(p){p.Success?f.popup?("approve"==l&&(location.href=p.RedirectTo),$("#lightbox, #lightbox-panel").fadeOutAndRemove()):f.refreshPageOnActionSuccess?location.reload(!0):e(j,p.MiniHtml):d(k,j,p.Message)},error:function(){d(k,j,"在提交的时候发生了一个错误，请重试！")},complete:StackPointer.helpers.removeSpinner}))},e=function(g,i){g.closest(".suggested-edit").fadeOut("slow",function(){i&&$(".suggested-edit:first").before(i).fadeIn("fast");$(this).remove()});h()},h=function(){$("#hlinks-nav .mod-flag-indicator.hotbg, #tabs .youarehere .mod-flag-indicator.hotbg").each(function(){var g=$(this);g.text((g.text()||0)-1);1>g.text()&&g.hide()})},d=function(g,i,j){StackPointer.helpers.removeSpinner();g.find("input[type=button]").not(i).fadeOut("fast");i.fadeOut("fast",function(){f.hideRefreshButton||$('<input type="button" class="refresh-button" onclick="location.reload(true)" value="刷新页面" style="display:none">').appendTo(g).fadeIn("fast");g.closest("table").find(".form-error").html(j).fadeIn("fast",function(){if(f.popup){var k=g.closest(".popup-suggested-edit");0<k.scrollTop()&&k.scrollTop(k.find(".suggested-edit").height())}})})},b=function(g){f=g||{};$(".approve-edit").unbind("click").click(function(){c($(this),"approve");return !1});$(".reject-edit").unbind("click").click(function(){c($(this),"reject");return !1});$(".improve-edit").unbind("click").click(function(){var i=$(this).closest(".post-menu").attr("id");window.window.location.href="/"+i+"s/"+$(this).closest(".suggested-edit").find(".post-id").text()+"/edit/?improve=true";return !1});$(".suggested-edit .action:not(.link)").unbind("click").click(function(){var j=$(this),k=j.hasClass("full-diff")?"full-diff":"full-html-diff",i=j.closest(".suggested-edit").find(".body-diffs");i.find("table:visible").hide();i.find("."+k).show();j.siblings(".action.selected").removeClass("selected");j.addClass("selected")})};return{init:b,loadPopup:function(g){if(!g.data("working")){StackPointer.helpers.addSpinner(g.data("working",!0),{padding:"3px 0"});var i=g.parent(),j=g.attr("id").substring(13);$.ajax({type:"GET",url:"/suggested-edits/popup/"+j,dataType:"html",success:function(k){var k=$('<div id="lightbox-panel" class="popup" style="display:block"><div class="popup-close"><a title="close this popup (or hit Esc)">&times;</a></div><div class="popup-suggested-edit">'+k+"</div></div>"),l=$(window).height();k.find(".popup-suggested-edit").css({"max-height":l-100});$('<div id="lightbox"/>').appendTo($("body")).css("height",$(document).height()).fadeIn("fast");k.appendTo(i).center().fadeIn("fast").find(".popup-close").click(function(){$("#lightbox, #lightbox-panel").fadeOutAndRemove()});b({popup:!0})},error:function(k){StackPointer.helpers.showErrorPopup(i,k.responseText&&200>k.responseText.length?k.responseText:"无法处理请求，请稍后再试！")},complete:function(){StackPointer.helpers.removeSpinner();g.removeData("working")}});return !1}}}}();