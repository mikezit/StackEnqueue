jQuery.extend({handleError:function(e,c,h,g){if(e.error){e.error.call(e.context||e,c,h,g)}},createUploadIframe:function(g,e){var f="jUploadFrame"+g;if(window.ActiveXObject){var h=document.createElement('<iframe id="'+f+'" name="'+f+'" />');if(typeof e=="boolean"){h.src="javascript:false"}else{if(typeof e=="string"){h.src=e}}}else{var h=document.createElement("iframe");h.id=f;h.name=f}h.style.position="absolute";h.style.top="-1000px";h.style.left="-1000px";document.body.appendChild(h);return h},createUploadForm:function(j,h){var l="jUploadForm"+j;var i="jUploadFile"+j;var m=$('<form  action="" method="POST" name="'+l+'" id="'+l+'" enctype="multipart/form-data"></form>');var n=$("#"+h);var k=$(n).clone();$(n).attr("id",i);$(n).before(k);$(n).appendTo(m);$(m).css("position","absolute");$(m).css("top","-1200px");$(m).css("left","-1200px");$(m).appendTo("body");return m},ajaxFileUpload:function(e){e=jQuery.extend({},jQuery.ajaxSettings,e);var t=new Date().getTime();var s=jQuery.createUploadForm(t,e.fileElementId);var m=jQuery.createUploadIframe(t,e.secureuri);var n="jUploadFrame"+t;var l="jUploadForm"+t;if(e.global&&!jQuery.active++){jQuery.event.trigger("ajaxStart")}var r=false;var p={};if(e.global){jQuery.event.trigger("ajaxSend",[p,e])}var q=function(b){var c=document.getElementById(n);try{if(c.contentWindow){p.responseText=c.contentWindow.document.body?c.contentWindow.document.body.innerText:null;p.responseXML=c.contentWindow.document.XMLDocument?c.contentWindow.document.XMLDocument:c.contentWindow.document}else{if(c.contentDocument){p.responseText=c.contentDocument.document.body?c.contentDocument.document.body.textContent||document.body.innerText:null;p.responseXML=c.contentDocument.document.XMLDocument?c.contentDocument.document.XMLDocument:c.contentDocument.document}}}catch(d){jQuery.handleError(e,p,null,d)}if(p||b=="timeout"){r=true;var a;try{a=b!="timeout"?"success":"error";if(a!="error"){var f=jQuery.uploadHttpData(p,e.dataType);if(e.success){e.success(f,a)}if(e.global){jQuery.event.trigger("ajaxSuccess",[p,e])}}else{jQuery.handleError(e,p,a)}}catch(d){a="error";jQuery.handleError(e,p,a,d)}if(e.global){jQuery.event.trigger("ajaxComplete",[p,e])}if(e.global&&!--jQuery.active){jQuery.event.trigger("ajaxStop")}if(e.complete){e.complete(p,a)}jQuery(c).unbind();setTimeout(function(){try{$(c).remove();$(s).remove()}catch(g){jQuery.handleError(e,p,null,g)}},100);p=null}};if(e.timeout>0){setTimeout(function(){if(!r){q("timeout")}},e.timeout)}try{var s=$("#"+l);$(s).attr("action",e.url);$(s).attr("method","POST");$(s).attr("target",n);if(s.encoding){s.encoding="multipart/form-data"}else{s.enctype="multipart/form-data"}$(s).submit()}catch(o){jQuery.handleError(e,p,null,o)}if(window.attachEvent){document.getElementById(n).attachEvent("onload",q)}else{document.getElementById(n).addEventListener("load",q,false)}return{abort:function(){}}},uploadHttpData:function(r,type){var data=!type;data=type=="xml"||data?r.responseXML:r.responseText;if(type=="script"){jQuery.globalEval(data)}if(type=="json"){eval("data = "+data)}if(type=="html"){jQuery("<div>").html(data).evalScripts()}return data}});function ajaxFileUpload(a){$("#loading").ajaxStart(function(){$(this).show()}).ajaxComplete(function(){$(this).hide()});$("#upload").ajaxStart(function(){$(this).hide()}).ajaxComplete(function(){$(this).show()});$.ajaxFileUpload({url:scriptUrl+"upload/",secureuri:false,fileElementId:"file-upload",dataType:"xml",success:function(e,b){var c=$(e).find("file_url").text();var d=$(e).find("error").text();if(d!=""){alert(d)}else{a.attr("value",appUrl+c)}},error:function(c,b,d){alert(d)}});return false}var Attacklab=Attacklab||{};Attacklab.wmdBase=function(){var n=top.Attacklab;var r=top.document;var j=top.RegExp;var f=top.navigator;n.Util={};n.Position={};n.Command={};n.Global={};var a=n.Util;var q=n.Position;var d=n.Command;var k=n.Global;k.isIE=/msie/.test(f.userAgent.toLowerCase());k.isIE_5or6=/msie 6/.test(f.userAgent.toLowerCase())||/msie 5/.test(f.userAgent.toLowerCase());k.isIE_7plus=k.isIE&&!k.isIE_5or6;k.isOpera=/opera/.test(f.userAgent.toLowerCase());k.isKonqueror=/konqueror/.test(f.userAgent.toLowerCase());var p="<p style='margin-top: 0px'>"+$.i18n._("enter image url")+"</p>";var s="<p style='margin-top: 0px'>"+$.i18n._("enter url")+"</p>";var g="<div>"+$.i18n._("upload image")+'</div><input type="file" name="file-upload" id="file-upload" size="26" onchange="return ajaxFileUpload($(\'#image-url\'));"/><br><img id="loading" src="'+mediaUrl("media/images/indicator.gif")+'" style="display:none;"/>';var b="http://";var c="http://";var h="images/";var o=500;var m=100;var e="http://wmd-editor.com/";var i="WMD website";var l="_blank";n.PanelCollection=function(){this.buttonBar=r.getElementById("wmd-button-bar");this.preview=r.getElementById("previewer");this.output=r.getElementById("wmd-output");this.input=r.getElementById("editor")};n.panels=undefined;n.ieCachedRange=null;n.ieRetardedClick=false;a.isVisible=function(t){if(window.getComputedStyle){return window.getComputedStyle(t,null).getPropertyValue("display")!=="none"}else{if(t.currentStyle){return t.currentStyle.display!=="none"}}};a.addEvent=function(u,t,v){if(u.attachEvent){u.attachEvent("on"+t,v)}else{u.addEventListener(t,v,false)}};a.removeEvent=function(u,t,v){if(u.detachEvent){u.detachEvent("on"+t,v)}else{u.removeEventListener(t,v,false)}};a.fixEolChars=function(t){t=t.replace(/\r\n/g,"\n");t=t.replace(/\r/g,"\n");return t};a.extendRegExp=function(w,y,v){if(y===null||y===undefined){y=""}if(v===null||v===undefined){v=""}var x=w.toString();var u="";var t=x.match(/\/([gim]*)$/);if(t===null){u=t[0]}else{u=""}x=x.replace(/(^\/|\/[gim]*$)/g,"");x=y+x+v;return new RegExp(x,u)};a.createImage=function(t){var v=h+t;var u=r.createElement("img");u.className="wmd-button";u.src=v;return u};a.prompt=function(A,D,v){var w;var t;var y;var x=0;if(arguments.length==4){x=arguments[3]}if(D===undefined){D=""}var z=function(E){var F=(E.charCode||E.keyCode);if(F===27){B(true)}};var B=function(E){a.removeEvent(r.body,"keydown",z);var F=y.value;if(E){F=null}else{F=F.replace("http://http://","http://");F=F.replace("http://https://","https://");F=F.replace("http://ftp://","ftp://");if(F.indexOf("http://")===-1&&F.indexOf("ftp://")===-1&&F.indexOf("https://")===-1){F="http://"+F}}w.parentNode.removeChild(w);t.parentNode.removeChild(t);v(F);return false};var u=function(){t=r.createElement("div");t.className="wmd-prompt-background";style=t.style;style.position="absolute";style.top="0";style.zIndex="1000";if(k.isKonqueror){style.backgroundColor="transparent"}else{if(k.isIE){style.filter="alpha(opacity=50)"}else{style.opacity="0.5"}}var E=q.getPageSize();style.height=E[1]+"px";if(k.isIE){style.left=r.documentElement.scrollLeft;style.width=r.documentElement.clientWidth}else{style.left="0";style.width="100%"}r.body.appendChild(t)};var C=function(){w=r.createElement("div");w.className="wmd-prompt-dialog";w.style.padding="10px;";w.style.position="fixed";w.style.width="400px";w.style.zIndex="1001";var E=r.createElement("div");E.innerHTML=A;E.style.padding="5px";w.appendChild(E);var G=r.createElement("form");G.onsubmit=function(){return B(false)};style=G.style;style.padding="0";style.margin="0";style.cssFloat="left";style.width="100%";style.textAlign="center";style.position="relative";w.appendChild(G);y=r.createElement("input");y.id="image-url";y.type="text";y.value=D;style=y.style;style.display="block";style.width="80%";style.marginLeft=style.marginRight="auto";G.appendChild(y);var F=r.createElement("div");F.innerHTML=g;F.style.padding="5px";G.appendChild(F);var I=r.createElement("input");I.type="button";I.onclick=function(){return B(false)};I.value="OK";style=I.style;style.margin="10px";style.display="inline";style.width="7em";var H=r.createElement("input");H.type="button";H.onclick=function(){return B(true)};H.value="Cancel";style=H.style;style.margin="10px";style.display="inline";style.width="7em";if(/mac/.test(f.platform.toLowerCase())){G.appendChild(H);G.appendChild(I)}else{G.appendChild(I);G.appendChild(H)}a.addEvent(r.body,"keydown",z);w.style.top="50%";w.style.left="50%";w.style.display="block";if(k.isIE_5or6){w.style.position="absolute";w.style.top=r.documentElement.scrollTop+200+"px";w.style.left="50%"}r.body.appendChild(w);w.style.marginTop=-(q.getHeight(w)/2)+"px";w.style.marginLeft=-(q.getWidth(w)/2)+"px"};u();top.setTimeout(function(){C();var F=D.length;if(y.selectionStart!==undefined){y.selectionStart=0;y.selectionEnd=F}else{if(y.createTextRange){var E=y.createTextRange();E.collapse(false);E.moveStart("character",-F);E.moveEnd("character",F);E.select()}}y.focus()},0)};q.getTop=function(v,u){var t=v.offsetTop;if(!u){while(v=v.offsetParent){t+=v.offsetTop}}return t};q.getHeight=function(t){return t.offsetHeight||t.scrollHeight};q.getWidth=function(t){return t.offsetWidth||t.scrollWidth};q.getPageSize=function(){var u,v;var t,y;if(self.innerHeight&&self.scrollMaxY){u=r.body.scrollWidth;v=self.innerHeight+self.scrollMaxY}else{if(r.body.scrollHeight>r.body.offsetHeight){u=r.body.scrollWidth;v=r.body.scrollHeight}else{u=r.body.offsetWidth;v=r.body.offsetHeight}}if(self.innerHeight){t=self.innerWidth;y=self.innerHeight}else{if(r.documentElement&&r.documentElement.clientHeight){t=r.documentElement.clientWidth;y=r.documentElement.clientHeight}else{if(r.body){t=r.body.clientWidth;y=r.body.clientHeight}}}var x=Math.max(u,t);var w=Math.max(v,y);return[x,w,t,y]};n.inputPoller=function(C,v){var t=this;var y=n.panels.input;var u;var w;var z;var x;this.tick=function(){if(!a.isVisible(y)){return}if(y.selectionStart||y.selectionStart===0){var E=y.selectionStart;var D=y.selectionEnd;if(E!=u||D!=w){u=E;w=D;if(z!=y.value){z=y.value;return true}}}return false};var B=function(){if(!a.isVisible(y)){return}if(t.tick()){C()}};var A=function(){x=top.setInterval(B,v)};this.destroy=function(){top.clearInterval(x)};A()};n.undoManager=function(E){var I=this;var C=[];var A=0;var z="none";var u;var F;var v;var y;var t=function(K,J){if(z!=K){z=K;if(!J){w()}}if(!k.isIE||z!="moving"){v=top.setTimeout(B,1)}else{y=null}};var B=function(){y=new n.TextareaState();F.tick();v=undefined};this.setCommandMode=function(){z="command";w();v=top.setTimeout(B,0)};this.canUndo=function(){return A>1};this.canRedo=function(){if(C[A+1]){return true}return false};this.undo=function(){if(I.canUndo()){if(u){u.restore();u=null}else{C[A]=new n.TextareaState();C[--A].restore();if(E){E()}}}z="none";n.panels.input.focus();B()};this.redo=function(){if(I.canRedo()){C[++A].restore();if(E){E()}}z="none";n.panels.input.focus();B()};var w=function(){var J=y||new n.TextareaState();if(!J){return false}if(z=="moving"){if(!u){u=J}return}if(u){if(C[A-1].text!=u.text){C[A++]=u}u=null}C[A++]=J;C[A+1]=null;if(E){E()}};var D=function(J){var L=false;if(J.ctrlKey||J.metaKey){var K=J.charCode||J.keyCode;var M=String.fromCharCode(K);switch(M){case"y":I.redo();L=true;break;case"z":if(!J.shiftKey){I.undo()}else{I.redo()}L=true;break}}if(L){if(J.preventDefault){J.preventDefault()}if(top.event){top.event.returnValue=false}return}};var H=function(J){if(!J.ctrlKey&&!J.metaKey){var K=J.keyCode;if((K>=33&&K<=40)||(K>=63232&&K<=63235)){t("moving")}else{if(K==8||K==46||K==127){t("deleting")}else{if(K==13){t("newlines")}else{if(K==27){t("escape")}else{if((K<16||K>20)&&K!=91){t("typing")}}}}}}};var x=function(){a.addEvent(n.panels.input,"keypress",function(K){if((K.ctrlKey||K.metaKey)&&(K.keyCode==89||K.keyCode==90)){K.preventDefault()}});var J=function(){if(k.isIE||(y&&y.text!=n.panels.input.value)){if(v==undefined){z="paste";w();B()}}};F=new n.inputPoller(J,m);a.addEvent(n.panels.input,"keydown",D);a.addEvent(n.panels.input,"keydown",H);a.addEvent(n.panels.input,"mousedown",function(){t("moving")});n.panels.input.onpaste=J;n.panels.input.ondrop=J};var G=function(){x();B();w()};this.destroy=function(){if(F){F.destroy()}};G()};n.editor=function(C){if(!C){C=function(){}}var z=n.panels.input;var w=0;var D=this;var y;var F;var u;var A;var B;var I=function(K){z.focus();if(K.textOp){if(B){B.setCommandMode()}var M=new n.TextareaState();if(!M){return}var O=M.getChunks();var J=function(){z.focus();if(O){M.setChunks(O)}M.restore();C()};var N=true;var L=K.textOp(O,J,N);if(!L){J()}}if(K.execute){K.execute(D)}};var G=function(){if(B){t(document.getElementById("wmd-undo-button"),B.canUndo());t(document.getElementById("wmd-redo-button"),B.canRedo())}};var t=function(J,L){var M="0px";var N="-20px";var K="-40px";if(L){J.style.backgroundPosition=J.XShift+" "+M;J.onmouseover=function(){this.style.backgroundPosition=this.XShift+" "+K};J.onmouseout=function(){this.style.backgroundPosition=this.XShift+" "+M};if(k.isIE){J.onmousedown=function(){n.ieRetardedClick=true;n.ieCachedRange=document.selection.createRange()}}if(!J.isHelp){J.onclick=function(){if(this.onmouseout){this.onmouseout()}I(this);return false}}}else{J.style.backgroundPosition=J.XShift+" "+N;J.onmouseover=J.onmouseout=J.onclick=function(){}}};var x=function(){var N=document.getElementById("wmd-button-bar");var K="0px";var M="-20px";var S="-40px";var Y=document.createElement("ul");Y.id="wmd-button-row";Y=N.appendChild(Y);var R=document.createElement("li");R.className="wmd-button";R.id="wmd-bold-button";R.title="粗体 <strong> Ctrl+B";R.XShift="0px";R.textOp=d.doBold;t(R,true);Y.appendChild(R);var Q=document.createElement("li");Q.className="wmd-button";Q.id="wmd-italic-button";Q.title="斜体 <em> Ctrl+I";Q.XShift="-20px";Q.textOp=d.doItalic;t(Q,true);Y.appendChild(Q);var V=document.createElement("li");V.className="wmd-spacer";V.id="wmd-spacer1";Y.appendChild(V);var W=document.createElement("li");W.className="wmd-button";W.id="wmd-link-button";W.title="超链接 <a> Ctrl+L";W.XShift="-40px";W.textOp=function(af,ag,ah){return d.doLinkOrImage(af,ag,false)};t(W,true);Y.appendChild(W);var Z=document.createElement("li");Z.className="wmd-button";Z.id="wmd-quote-button";Z.title="缩进 <blockquote> Ctrl+Q";Z.XShift="-60px";Z.textOp=d.doBlockquote;t(Z,true);Y.appendChild(Z);var aa=document.createElement("li");aa.className="wmd-button";aa.id="wmd-code-button";aa.title="代码 <pre><code> Ctrl+K";aa.XShift="-80px";aa.textOp=d.doCode;t(aa,true);Y.appendChild(aa);var O=document.createElement("li");O.className="wmd-button";O.id="wmd-image-button";O.title="图片 <img> Ctrl+G";O.XShift="-100px";O.textOp=function(af,ag,ah){return d.doLinkOrImage(af,ag,true)};t(O,true);Y.appendChild(O);var U=document.createElement("li");U.className="wmd-spacer";U.id="wmd-spacer2";Y.appendChild(U);var P=document.createElement("li");P.className="wmd-button";P.id="wmd-olist-button";P.title="数字列表 <ol> Ctrl+O";P.XShift="-120px";P.textOp=function(af,ag,ah){d.doList(af,ag,true,ah)};t(P,true);Y.appendChild(P);var ad=document.createElement("li");ad.className="wmd-button";ad.id="wmd-ulist-button";ad.title="列表 <ul> Ctrl+U";ad.XShift="-140px";ad.textOp=function(af,ag,ah){d.doList(af,ag,false,ah)};t(ad,true);Y.appendChild(ad);var X=document.createElement("li");X.className="wmd-button";X.id="wmd-heading-button";X.title="标题 <h1>/<h2> Ctrl+H";X.XShift="-160px";X.textOp=d.doHeading;t(X,true);Y.appendChild(X);var L=document.createElement("li");L.className="wmd-button";L.id="wmd-hr-button";L.title="横线 <hr> Ctrl+R";L.XShift="-180px";L.textOp=d.doHorizontalRule;t(L,true);Y.appendChild(L);var T=document.createElement("li");T.className="wmd-spacer";T.id="wmd-spacer3";Y.appendChild(T);var J=document.createElement("li");J.className="wmd-button";J.id="wmd-undo-button";J.title="撤销 - Ctrl+Z";J.XShift="-200px";J.execute=function(af){af.undo()};t(J,true);Y.appendChild(J);var ac=document.createElement("li");ac.className="wmd-button";ac.id="wmd-redo-button";ac.title="重做 - Ctrl+Y";if(/win/.test(f.platform.toLowerCase())){ac.title="Redo - Ctrl+Y"}else{ac.title="重做 - Ctrl+Shift+Z"}ac.XShift="-220px";ac.execute=function(af){af.redo()};t(ac,true);Y.appendChild(ac);G();var ab=document.createElement("li");ab.className="wmd-button";ab.id="wmd-help-button";ab.title="编辑帮助";ab.isHelp=true;ab.XShift="-140px";var ae=document.createElement("a");ae.href="/markdown_help";ae.target="_blank";ab.appendChild(ae);Y.appendChild(ab)};var v=function(){if(/\?noundo/.test(r.location.href)){n.nativeUndo=true}if(!n.nativeUndo){B=new n.undoManager(function(){C();G()})}x();var K="keydown";if(k.isOpera){K="keypress"}a.addEvent(z,K,function(M){if(M.ctrlKey||M.metaKey){var N=M.charCode||M.keyCode;var L=String.fromCharCode(N).toLowerCase();switch(L){case"b":I(document.getElementById("wmd-bold-button"));break;case"i":I(document.getElementById("wmd-italic-button"));break;case"l":I(document.getElementById("wmd-link-button"));break;case"q":I(document.getElementById("wmd-quote-button"));break;case"k":I(document.getElementById("wmd-code-button"));break;case"g":I(document.getElementById("wmd-image-button"));break;case"o":I(document.getElementById("wmd-olist-button"));break;case"u":I(document.getElementById("wmd-ulist-button"));break;case"h":I(document.getElementById("wmd-heading-button"));break;case"r":I(document.getElementById("wmd-hr-button"));break;case"y":I(document.getElementById("wmd-redo-button"));break;case"z":if(M.shiftKey){I(document.getElementById("wmd-redo-button"))}else{I(document.getElementById("wmd-undo-button"))}break;default:return}if(M.preventDefault){M.preventDefault()}if(top.event){top.event.returnValue=false}}});a.addEvent(z,"keyup",function(L){if(!L.shiftKey&&!L.ctrlKey&&!L.metaKey){var M=L.charCode||L.keyCode;if(M===13){fakeButton={};fakeButton.textOp=d.doAutoindent;I(fakeButton)}}});if(k.isIE){a.addEvent(z,"keydown",function(L){var M=L.keyCode;if(M===27){return false}})}if(z.form){var J=z.form.onsubmit;z.form.onsubmit=function(){E();if(J){return J.apply(this,arguments)}}}};var E=function(){if(n.showdown){var J=new n.showdown.converter()}var K=z.value;var L=function(){z.value=K};if(!/markdown/.test(n.wmd_env.output.toLowerCase())){if(J){z.value=J.makeHtml(K);top.setTimeout(L,0)}}return true};this.undo=function(){if(B){B.undo()}};this.redo=function(){if(B){B.redo()}};var H=function(){v()};this.destroy=function(){if(B){B.destroy()}if(u.parentNode){u.parentNode.removeChild(u)}if(z){z.style.marginTop=""}top.clearInterval(A)};H()};n.TextareaState=function(){var t=this;var u=n.panels.input;this.init=function(){if(!a.isVisible(u)){return}this.setInputAreaSelectionStartEnd();this.scrollTop=u.scrollTop;if(!this.text&&u.selectionStart||u.selectionStart===0){this.text=u.value}};this.setInputAreaSelection=function(){if(!a.isVisible(u)){return}if(u.selectionStart!==undefined&&!k.isOpera){u.focus();u.selectionStart=t.start;u.selectionEnd=t.end;u.scrollTop=t.scrollTop}else{if(r.selection){if(r.activeElement&&r.activeElement!==u){return}u.focus();var v=u.createTextRange();v.moveStart("character",-u.value.length);v.moveEnd("character",-u.value.length);v.moveEnd("character",t.end);v.moveStart("character",t.start);v.select()}}};this.setInputAreaSelectionStartEnd=function(){if(u.selectionStart||u.selectionStart===0){t.start=u.selectionStart;t.end=u.selectionEnd}else{if(r.selection){t.text=a.fixEolChars(u.value);var y;if(n.ieRetardedClick&&n.ieCachedRange){y=n.ieCachedRange;n.ieRetardedClick=false}else{y=r.selection.createRange()}var z=a.fixEolChars(y.text);var x="\x07";var w=x+z+x;y.text=w;var A=a.fixEolChars(u.value);y.moveStart("character",-w.length);y.text=z;t.start=A.indexOf(x);t.end=A.lastIndexOf(x)-x.length;var v=t.text.length-a.fixEolChars(u.value).length;if(v){y.moveStart("character",-z.length);while(v--){z+="\n";t.end+=1}y.text=z}this.setInputAreaSelection()}}};this.restore=function(){if(t.text!=undefined&&t.text!=u.value){u.value=t.text}this.setInputAreaSelection();u.scrollTop=t.scrollTop};this.getChunks=function(){var v=new n.Chunks();v.before=a.fixEolChars(t.text.substring(0,t.start));v.startTag="";v.selection=a.fixEolChars(t.text.substring(t.start,t.end));v.endTag="";v.after=a.fixEolChars(t.text.substring(t.end));v.scrollTop=t.scrollTop;return v};this.setChunks=function(v){v.before=v.before+v.startTag;v.after=v.endTag+v.after;if(k.isOpera){v.before=v.before.replace(/\n/g,"\r\n");v.selection=v.selection.replace(/\n/g,"\r\n");v.after=v.after.replace(/\n/g,"\r\n")}this.start=v.before.length;this.end=v.before.length+v.selection.length;this.text=v.before+v.selection+v.after;this.scrollTop=v.scrollTop};this.init()};n.Chunks=function(){};n.Chunks.prototype.findTags=function(u,w){var t=this;var v;if(u){v=a.extendRegExp(u,"","$");this.before=this.before.replace(v,function(x){t.startTag=t.startTag+x;return""});v=a.extendRegExp(u,"^","");this.selection=this.selection.replace(v,function(x){t.startTag=t.startTag+x;return""})}if(w){v=a.extendRegExp(w,"","$");this.selection=this.selection.replace(v,function(x){t.endTag=x+t.endTag;return""});v=a.extendRegExp(w,"^","");this.after=this.after.replace(v,function(x){t.endTag=x+t.endTag;return""})}};n.Chunks.prototype.trimWhitespace=function(t){this.selection=this.selection.replace(/^(\s*)/,"");if(!t){this.before+=j.$1}this.selection=this.selection.replace(/(\s*)$/,"");if(!t){this.after=j.$1+this.after}};n.Chunks.prototype.addBlankLines=function(v,u,t){if(v===undefined){v=1}if(u===undefined){u=1}v++;u++;var w;var x;if(navigator.userAgent.match(/Chrome/)){"X".match(/()./)}this.selection=this.selection.replace(/(^\n*)/,"");this.startTag=this.startTag+j.$1;this.selection=this.selection.replace(/(\n*$)/,"");this.endTag=this.endTag+j.$1;this.startTag=this.startTag.replace(/(^\n*)/,"");this.before=this.before+j.$1;this.endTag=this.endTag.replace(/(\n*$)/,"");this.after=this.after+j.$1;if(this.before){w=x="";while(v--){w+="\\n?";x+="\n"}if(t){w="\\n*"}this.before=this.before.replace(new j(w+"$",""),x)}if(this.after){w=x="";while(u--){w+="\\n?";x+="\n"}if(t){w="\\n*"}this.after=this.after.replace(new j(w,""),x)}};d.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)";d.unwrap=function(u){var t=new j("([^\\n])\\n(?!(\\n|"+d.prefixes+"))","g");u.selection=u.selection.replace(t,"$1 $2")};d.wrap=function(u,t){d.unwrap(u);var v=new j("(.{1,"+t+"})( +|$\\n?)","gm");u.selection=u.selection.replace(v,function(w,x){if(new j("^"+d.prefixes,"").test(w)){return w}return x+"\n"});u.selection=u.selection.replace(/\s+$/,"")};d.doBold=function(t,u,v){return d.doBorI(t,2,"strong text")};d.doItalic=function(t,u,v){return d.doBorI(t,1,"emphasized text")};d.doBorI=function(w,A,z){w.trimWhitespace();w.selection=w.selection.replace(/\n{2,}/g,"\n");w.before.search(/(\**$)/);var y=j.$1;w.after.search(/(^\**)/);var x=j.$1;var t=Math.min(y.length,x.length);if((t>=A)&&(t!=2||A!=1)){w.before=w.before.replace(j("[*]{"+A+"}$",""),"");w.after=w.after.replace(j("^[*]{"+A+"}",""),"")}else{if(!w.selection&&x){w.after=w.after.replace(/^([*_]*)/,"");w.before=w.before.replace(/(\s?)$/,"");var v=j.$1;w.before=w.before+x+v}else{if(!w.selection&&!x){w.selection=z}var u=A<=1?"*":"**";w.before=w.before+u;w.after=u+w.after}}return};d.stripLinkDefs=function(u,t){u=u.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(y,z,v,w,x){t[z]=y.replace(/\s*$/,"");if(w){t[z]=y.replace(/["(](.+?)[")]$/,"");return w+x}return""});return u};d.addLinkDef=function(A,w){var t=0;var v={};A.before=d.stripLinkDefs(A.before,v);A.selection=d.stripLinkDefs(A.selection,v);A.after=d.stripLinkDefs(A.after,v);var u="";var z=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g;var y=function(C){t++;C=C.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+t+"]:");u+="\n"+C};var x=function(D,G,E,F,H,C){E=E.replace(z,x);if(v[H]){y(v[H]);return G+E+F+t+C}return D};A.before=A.before.replace(z,x);if(w){y(w)}else{A.selection=A.selection.replace(z,x)}var B=t;A.after=A.after.replace(z,x);if(A.after){A.after=A.after.replace(/\n*$/,"")}if(!A.after){A.selection=A.selection.replace(/\n*$/,"")}A.after+="\n\n"+u;return B};d.doLinkOrImage=function(t,u,w){t.trimWhitespace();t.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);if(t.endTag.length>1){t.startTag=t.startTag.replace(/!?\[/,"");t.endTag="";d.addLinkDef(t,null)}else{if(/\n\n/.test(t.selection)){d.addLinkDef(t,null);return}var v=function(z){if(z!==null){t.startTag=t.endTag="";var y=" [999]: "+z;var x=d.addLinkDef(t,y);t.startTag=w?"![":"[";t.endTag="]["+x+"]";if(!t.selection){if(w){t.selection="alt text"}else{t.selection="link text"}}}u()};if(w){a.prompt(p,b,v,1)}else{a.prompt(s,c,v)}return true}};a.makeAPI=function(){n.wmd={};n.wmd.editor=n.editor;n.wmd.previewManager=n.previewManager};a.startEditor=function(){if(n.wmd_env.autostart===false){a.makeAPI();return}var u;var t;var v=function(){n.panels=new n.PanelCollection();t=new n.previewManager();var w=t.refresh;u=new n.editor(w);t.refresh(true)};a.addEvent(top,"load",v)};n.previewManager=function(){var v=this;var J;var t;var B;var A;var G;var C;var w=3000;var D="delayed";var y=function(L,M){a.addEvent(L,"input",M);L.onpaste=M;L.ondrop=M;a.addEvent(L,"keypress",M);a.addEvent(L,"keydown",M);t=new n.inputPoller(M,o)};var F=function(){var L=0;if(top.innerHeight){L=top.pageYOffset}else{if(r.documentElement&&r.documentElement.scrollTop){L=r.documentElement.scrollTop}else{if(r.body){L=r.body.scrollTop}}}return L};var z=function(){if(!n.panels.preview&&!n.panels.output){return}var N=n.panels.input.value;if(N&&N==G){return}else{G=N}var M=new Date().getTime();if(!J&&n.showdown){J=new n.showdown.converter()}if(J){N=J.makeHtml(N)}var L=new Date().getTime();A=L-M;u(N);C=N};var I=function(){if(B){top.clearTimeout(B);B=undefined}if(D!=="manual"){var L=0;if(D==="delayed"){L=A}if(L>w){L=w}B=top.setTimeout(z,L)}};var x=function(L){if(L.scrollHeight<=L.clientHeight){return 1}return L.scrollTop/(L.scrollHeight-L.clientHeight)};var K=function(){if(n.panels.preview){n.panels.preview.scrollTop=(n.panels.preview.scrollHeight-n.panels.preview.clientHeight)*x(n.panels.preview)}if(n.panels.output){n.panels.output.scrollTop=(n.panels.output.scrollHeight-n.panels.output.clientHeight)*x(n.panels.output)}};this.refresh=function(L){if(L){G="";z()}else{I()}};this.processingTime=function(){return A};this.output=function(){return C};this.setUpdateMode=function(L){D=L;v.refresh()};var E=true;var u=function(O){var L=q.getTop(n.panels.input)-F();if(n.panels.output){if(n.panels.output.value!==undefined){n.panels.output.value=O;n.panels.output.readOnly=true}else{var N=O.replace(/&/g,"&amp;");N=N.replace(/</g,"&lt;");n.panels.output.innerHTML="<pre><code>"+N+"</code></pre>"}}if(n.panels.preview){n.panels.preview.innerHTML=O}K();if(E){E=false;return}var M=q.getTop(n.panels.input)-F();if(k.isIE){top.setTimeout(function(){top.scrollBy(0,M-L)},0)}else{top.scrollBy(0,M-L)}};var H=function(){y(n.panels.input,I);z();if(n.panels.preview){n.panels.preview.scrollTop=0}if(n.panels.output){n.panels.output.scrollTop=0}};this.destroy=function(){if(t){t.destroy()}};H()};d.doAutoindent=function(t,u,v){t.before=t.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n");t.before=t.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n");t.before=t.before.replace(/(\n|^)[ \t]+\n$/,"\n\n");v=false;if(/(\n|^)[ ]{0,3}([*+-])[ \t]+.*\n$/.test(t.before)){if(d.doList){d.doList(t,u,false,true)}}if(/(\n|^)[ ]{0,3}(\d+[.])[ \t]+.*\n$/.test(t.before)){if(d.doList){d.doList(t,u,true,true)}}if(/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(t.before)){if(d.doBlockquote){d.doBlockquote(t,u,v)}}if(/(\n|^)(\t|[ ]{4,}).*\n$/.test(t.before)){if(d.doCode){d.doCode(t,u,v)}}};d.doBlockquote=function(B,v,C){B.selection=B.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(H,G,F,E){B.before+=G;B.after=E+B.after;return F});B.before=B.before.replace(/(>[ \t]*)$/,function(F,E){B.selection=E+B.selection;return""});var A=C?"Blockquote":"";B.selection=B.selection.replace(/^(\s|>)+$/,"");B.selection=B.selection||A;var z="";var y="";if(B.before){var D=B.before.replace(/\n$/,"").split("\n");var x=false;for(var w in D){var u=false;line=D[w];x=x&&line.length>0;if(/^>/.test(line)){u=true;if(!x&&line.length>1){x=true}}else{if(/^[ \t]*$/.test(line)){u=true}else{u=x}}if(u){z+=line+"\n"}else{y+=z+line;z="\n"}}if(!/(^|\n)>/.test(z)){y+=z;z=""}}B.startTag=z;B.before=y;if(B.after){B.after=B.after.replace(/^\n?/,"\n")}B.after=B.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(E){B.endTag=E;return""});var t=function(F){var E=F?"> ":"";if(B.startTag){B.startTag=B.startTag.replace(/\n((>|\s)*)\n$/,function(H,G){return"\n"+G.replace(/^[ ]{0,3}>?[ \t]*$/gm,E)+"\n"})}if(B.endTag){B.endTag=B.endTag.replace(/^\n((>|\s)*)\n/,function(H,G){return"\n"+G.replace(/^[ ]{0,3}>?[ \t]*$/gm,E)+"\n"})}};if(/^(?![ ]{0,3}>)/m.test(B.selection)){d.wrap(B,n.wmd_env.lineLength-2);B.selection=B.selection.replace(/^/gm,"> ");t(true);B.addBlankLines()}else{B.selection=B.selection.replace(/^[ ]{0,3}> ?/gm,"");d.unwrap(B);t(false);if(!/^(\n|^)[ ]{0,3}>/.test(B.selection)&&B.startTag){B.startTag=B.startTag.replace(/\n{0,2}$/,"\n\n")}if(!/(\n|^)[ ]{0,3}>.*$/.test(B.selection)&&B.endTag){B.endTag=B.endTag.replace(/^\n{0,2}/,"\n\n")}}if(!/\n/.test(B.selection)){B.selection=B.selection.replace(/^(> *)/,function(E,F){B.startTag+=F;return""})}};d.doCode=function(t,u,y){var x=/\S[ ]*$/.test(t.before);var z=/^[ ]*\S/.test(t.after);if((!z&&!x)||/\n/.test(t.selection)){t.before=t.before.replace(/[ ]{4}$/,function(A){t.selection=A+t.selection;return""});var w=1;var v=1;if(/\n(\t|[ ]{4,}).*\n$/.test(t.before)||t.after===""){w=0}if(/^\n(\t|[ ]{4,})/.test(t.after)){v=0}t.addBlankLines(w,v);if(!t.selection){t.startTag="    ";t.selection=y?"enter code here":""}else{if(/^[ ]{0,3}\S/m.test(t.selection)){t.selection=t.selection.replace(/^/gm,"    ")}else{t.selection=t.selection.replace(/^[ ]{4}/gm,"")}}}else{t.trimWhitespace();t.findTags(/`/,/`/);if(!t.startTag&&!t.endTag){t.startTag=t.endTag="`";if(!t.selection){t.selection=y?"enter code here":""}}else{if(t.endTag&&!t.startTag){t.before+=t.endTag;t.endTag=""}else{t.startTag=t.endTag=""}}}};d.doList=function(E,x,w,G){var H=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/;var F=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/;var t="-";var B=1;var z=function(){var I;if(w){I=" "+B+". ";B++}else{I=" "+t+" "}return I};var A=function(I){if(w===undefined){w=/^\s*\d/.test(I)}I=I.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(J){return z()});return I};E.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null);if(E.before&&!/\n$/.test(E.before)&&!/^\n/.test(E.startTag)){E.before+=E.startTag;E.startTag=""}if(E.startTag){var v=/\d+[.]/.test(E.startTag);E.startTag="";E.selection=E.selection.replace(/\n[ ]{4}/g,"\n");d.unwrap(E);E.addBlankLines();if(v){E.after=E.after.replace(F,A)}if(w==v){return}}var y=1;E.before=E.before.replace(H,function(I){if(/^\s*([*+-])/.test(I)){t=j.$1}y=/[^\n]\n\n[^\n]/.test(I)?1:0;return A(I)});if(!E.selection){E.selection=G?"List item":" "}var C=z();var u=1;E.after=E.after.replace(F,function(I){u=/[^\n]\n\n[^\n]/.test(I)?1:0;return A(I)});E.trimWhitespace(true);E.addBlankLines(y,u,true);E.startTag=C;var D=C.replace(/./g," ");d.wrap(E,n.wmd_env.lineLength-D.length);E.selection=E.selection.replace(/\n/g,"\n"+D)};d.doHeading=function(v,w,z){v.selection=v.selection.replace(/\s+/g," ");v.selection=v.selection.replace(/(^\s+|\s+$)/g,"");if(!v.selection){v.startTag="## ";v.selection="Heading";v.endTag=" ##";return}var x=0;v.findTags(/#+[ ]*/,/[ ]*#+/);if(/#+/.test(v.startTag)){x=j.lastMatch.length}v.startTag=v.endTag="";v.findTags(null,/\s?(-+|=+)/);if(/=+/.test(v.endTag)){x=1}if(/-+/.test(v.endTag)){x=2}v.startTag=v.endTag="";v.addBlankLines(1,1);var y=x==0?2:x-1;if(y>0){var u=y>=2?"-":"=";var t=v.selection.length;if(t>n.wmd_env.lineLength){t=n.wmd_env.lineLength}v.endTag="\n";while(t--){v.endTag+=u}}};d.doHorizontalRule=function(t,u,v){t.startTag="----------\n";t.selection="";t.addBlankLines(2,1,true)}};Attacklab.wmd_env={};Attacklab.account_options={};Attacklab.wmd_defaults={version:1,output:"HTML",lineLength:40,delayLoad:false};if(!Attacklab.wmd){Attacklab.wmd=function(){Attacklab.loadEnv=function(){var b=function(d){if(!d){return}for(var c in d){Attacklab.wmd_env[c]=d[c]}};b(Attacklab.wmd_defaults);b(Attacklab.account_options);b(top.wmd_options);Attacklab.full=true;var a="bold italic link blockquote code image ol ul heading hr";Attacklab.wmd_env.buttons=Attacklab.wmd_env.buttons||a};Attacklab.loadEnv()};Attacklab.wmd();Attacklab.wmdBase();Attacklab.Util.startEditor()};